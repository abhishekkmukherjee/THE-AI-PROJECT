# Building a Complete NCERT AI Tutor: From Local Vicuna-7B to Scalable Educational Assistant

## Project Overview

I've built a comprehensive AI-powered educational assistant that transforms static NCERT textbooks into an intelligent, conversational tutor for Class 6 students. This project demonstrates the complete journey from PDF content extraction to deploying a local Vicuna-7B model with advanced scalability features.

**Key Achievement**: A production-ready educational AI that runs entirely offline, handles concurrent users, and provides accurate, contextual answers from NCERT curriculum content.

## System Architecture

### High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND LAYER                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   index.html    â”‚  â”‚   script.js     â”‚  â”‚   style.css     â”‚ â”‚
â”‚  â”‚ â€¢ Modern UI     â”‚  â”‚ â€¢ Chat Logic    â”‚  â”‚ â€¢ Responsive    â”‚ â”‚
â”‚  â”‚ â€¢ Voice Controlsâ”‚  â”‚ â€¢ Speech API    â”‚  â”‚ â€¢ Animations    â”‚ â”‚
â”‚  â”‚ â€¢ Chapter Selectâ”‚  â”‚ â€¢ Real-time     â”‚  â”‚ â€¢ Mobile Ready â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/WebSocket
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND LAYER (FastAPI)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     app.py      â”‚  â”‚  app_scalable   â”‚  â”‚   smart_app     â”‚ â”‚
â”‚  â”‚ â€¢ Full Features â”‚  â”‚ â€¢ Model Pool    â”‚  â”‚ â€¢ Auto-Fallbackâ”‚ â”‚
â”‚  â”‚ â€¢ Speech I/O    â”‚  â”‚ â€¢ Concurrency   â”‚  â”‚ â€¢ Graceful Deg. â”‚ â”‚
â”‚  â”‚ â€¢ Anti-Halluc.  â”‚  â”‚ â€¢ 8+ Users      â”‚  â”‚ â€¢ Lightweight   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI/ML LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Vicuna-7B      â”‚  â”‚   Model Pool    â”‚  â”‚  Quantization   â”‚ â”‚
â”‚  â”‚ â€¢ Q4_K_M (Fast) â”‚  â”‚ â€¢ 3 Instances   â”‚  â”‚ â€¢ Q6_K (Balancedâ”‚ â”‚
â”‚  â”‚ â€¢ Q6_K (Quality)â”‚  â”‚ â€¢ Thread Safe   â”‚  â”‚ â€¢ Q8 (Accuracy) â”‚ â”‚
â”‚  â”‚ â€¢ Q8 (Accuracy) â”‚  â”‚ â€¢ Load Balance  â”‚  â”‚ â€¢ Dynamic Switchâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  NCERT Content  â”‚  â”‚  Vector Store   â”‚  â”‚  Configuration  â”‚ â”‚
â”‚  â”‚ â€¢ chapter1.txt  â”‚  â”‚ â€¢ ChromaDB      â”‚  â”‚ â€¢ config.json   â”‚ â”‚
â”‚  â”‚ â€¢ chapter2.txt  â”‚  â”‚ â€¢ Embeddings    â”‚  â”‚ â€¢ Model Paths   â”‚ â”‚
â”‚  â”‚ â€¢ Structured    â”‚  â”‚ â€¢ Semantic      â”‚  â”‚ â€¢ API Settings  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## What's Been Accomplished

### 1. **Core AI Implementation**

#### **Local Vicuna-7B Deployment**
- **Technology**: llama-cpp-python for efficient CPU/GPU inference
- **Model Variants**: Q4_K_M (speed), Q6_K (balanced), Q8 (accuracy)
- **Memory Optimization**: 4-bit quantization reduces RAM usage from 14GB to 3.5GB
- **Performance**: Sub-5 second response times on consumer hardware

```python
# Dynamic model loading with quantization selection
def load_vicuna_model():
    model_type, model_path = select_best_model()
    
    if model_type == "q4_k_m":
        # Speed-optimized configuration
        configs = {
            "n_threads": 6,
            "n_batch": 512,
            "use_mmap": True
        }
    elif model_type == "q8":
        # Accuracy-optimized configuration  
        configs = {
            "n_threads": 4,
            "n_batch": 256,
            "f16_kv": True
        }
```

#### **Anti-Hallucination System**
- **Prompt Engineering**: Strict guardrails prevent AI from inventing facts
- **Source Validation**: Responses must be grounded in NCERT content
- **Fallback Detection**: Automatic switching to text-matching when AI hallucinates
- **General Knowledge Mode**: Safe answers for science/math questions outside curriculum

### 2. **Scalability Solutions**

#### **Model Pool Architecture**
```python
class ModelPool:
    def __init__(self, pool_size=3):
        self.pool = Queue(maxsize=pool_size)
        # Create 3 model instances for concurrent processing
        for _ in range(pool_size):
            model = self._create_model()
            self.pool.put(model)
```

**Before vs After Scalability:**
- **Before**: 1 model instance â†’ crashes with 3+ users
- **After**: 3 model instances â†’ handles 8+ concurrent users
- **Thread Pool**: Increased from 2 to 8 workers
- **Request Timeouts**: 30-second limits prevent server freeze
- **Memory Management**: Proper cleanup prevents memory leaks

### 3. **Advanced Features**

#### **Speech Integration**
- **Input**: Speech recognition with browser Web Speech API
- **Output**: Text-to-speech with pyttsx3 engine
- **Real-time**: Voice conversations with visual feedback
- **Fallback**: Graceful degradation when speech unavailable

#### **Intelligent Content Processing**
- **Chapter Classification**: Smart routing based on question content
- **Context Extraction**: Relevant passage identification
- **Multi-tier Fallback**: NCERT content â†’ General knowledge â†’ Helpful guidance

#### **Modern Web Interface**
- **Framework**: FastAPI backend + Vanilla JS frontend
- **Design**: Tailwind CSS with responsive layout
- **Features**: Real-time chat, voice controls, chapter selection
- **UX**: Teacher avatar with animations, typing indicators

## Technical Implementation Details

### **Backend Architecture (FastAPI)**

#### **Core Application Structure**
```python
app = FastAPI(title="NCERT AI Tutor")

# Key endpoints:
@app.post("/ask")           # Question answering
@app.get("/summarize/{chapter}")  # Chapter summaries  
@app.post("/speech-to-text") # Voice input
@app.post("/voice-chat")    # Full voice pipeline
@app.get("/health")         # System status
```

#### **Request Processing Flow**
```
User Question â†’ Chapter Detection â†’ Content Retrieval â†’ AI Processing â†’ Response Generation
     â†“
Anti-Hallucination Check â†’ Fallback if Needed â†’ Text-to-Speech â†’ Frontend Display
```

### **AI/ML Pipeline**

#### **Model Quantization Strategy**
- **Q4_K_M**: 3.5GB RAM, fastest inference (real-time chat)
- **Q6_K**: 5GB RAM, balanced performance (general use)  
- **Q8**: 7GB RAM, highest accuracy (complex explanations)

#### **Content Processing Pipeline**
```python
def enhanced_fallback_with_general_knowledge(question, content):
    # 1. Try NCERT content extraction
    ncert_answer = get_intelligent_ncert_answer(question, content)
    if ncert_answer:
        return ncert_answer
    
    # 2. Check for general knowledge questions
    if is_general_knowledge_question(question):
        return get_safe_general_knowledge_answer(question)
    
    # 3. Provide helpful guidance
    return "Could you ask about the chapter's characters or events?"
```

### **Frontend Architecture**

#### **ChatApp Class Structure**
```javascript
class ChatApp {
    constructor() {
        this.initEventListeners();
        this.initChapterSelection();
        this.checkMicrophoneSupport();
    }
    
    // Core methods:
    sendMessage()          // Handle text input
    toggleRecording()      // Voice input control
    selectChapter()        // Chapter-specific context
    updateStatus()         // Real-time feedback
}
```

#### **Real-time Features**
- **WebSocket-ready**: Prepared for live updates
- **Voice Controls**: Microphone and speaker toggles
- **Visual Feedback**: Typing indicators, status updates
- **Mobile Responsive**: Touch-friendly interface

## Performance Metrics & Testing

### **Concurrent User Testing**
```python
# test_concurrent_users.py results:
async def test_concurrent_users(num_users=5):
    # Simulates 5 simultaneous users
    # Measures response times and success rates
    
# Results:
# 8+ concurrent users supported
# Average response time: 3.2 seconds
# 99.5% success rate under load
# No memory leaks after 100+ requests
```

### **Model Performance Comparison**
| Quantization | RAM Usage | Response Time | Accuracy | Best For |
|--------------|-----------|---------------|----------|----------|
| Q4_K_M       | 3.5GB     | 2.1s         | Good     | Real-time chat |
| Q6_K         | 5.0GB     | 3.2s         | Better   | General tutoring |
| Q8           | 7.0GB     | 4.8s         | Highest  | Complex analysis |

### **System Requirements**
- **Minimum**: 4GB RAM, 2-core CPU (Simple mode)
- **Recommended**: 8GB RAM, 4-core CPU (AI mode)
- **Optimal**: 16GB RAM, GPU with 6GB+ VRAM

## ML/AI Technologies Used

### **Core AI Stack**
1. **Vicuna-7B Model**: LLaMA-based conversational AI
2. **llama-cpp-python**: Efficient C++ inference engine
3. **Quantization**: 4-bit/6-bit/8-bit model compression
4. **ChromaDB**: Vector database for semantic search
5. **SentenceTransformers**: Text embeddings for content matching

### **Supporting Technologies**
1. **FastAPI**: High-performance async web framework
2. **Uvicorn**: ASGI server for production deployment
3. **SpeechRecognition**: Voice input processing
4. **pyttsx3**: Text-to-speech synthesis
5. **Tailwind CSS**: Modern responsive styling

### **Development Tools**
1. **Python 3.8+**: Core programming language
2. **PyTorch**: Deep learning framework (optional GPU acceleration)
3. **NumPy**: Numerical computing
4. **Pydantic**: Data validation and serialization

## Key Features Implemented

### **1. Adaptive Intelligence System**
```python
def detect_available_capabilities():
    """Automatically detects hardware/software capabilities"""
    capabilities = {
        "ai_model": check_model_availability(),
        "gpu_acceleration": check_cuda_support(), 
        "speech_recognition": check_speech_support(),
        "memory_available": get_available_memory()
    }
    return select_optimal_mode(capabilities)
```

### **2. Multi-Modal Interaction**
- **Text Chat**: Traditional typing interface
- **Voice Input**: Speech-to-text conversion
- **Audio Output**: Text-to-speech responses
- **Visual Feedback**: Animations and status indicators

### **3. Educational Content Management**
- **Chapter Selection**: Contextual question answering
- **Content Extraction**: Intelligent passage retrieval
- **Summarization**: Automated chapter overviews
- **Progress Tracking**: Chat history and session management

### **4. Production-Ready Features**
- **Error Handling**: Graceful failure recovery
- **Logging**: Comprehensive system monitoring
- **Configuration**: Environment-based settings
- **Security**: Input validation and sanitization

## Future Development Plans

### **Phase 1: Enhanced AI Capabilities (Next 2-3 months)**

#### **1. Advanced Model Integration**
- **Larger Models**: Support for Vicuna-13B and Llama-2-70B
- **Fine-tuning**: Custom training on NCERT-specific datasets
- **Multi-language**: Hindi language support with Indic models
- **Specialized Models**: Math-specific and science-specific AI assistants

#### **2. Improved Content Processing**
```python
# Planned enhancements:
class AdvancedContentProcessor:
    def __init__(self):
        self.pdf_extractor = PDFMinerExtractor()
        self.image_processor = OCRProcessor()
        self.diagram_analyzer = DiagramAI()
        
    def process_complete_textbook(self, pdf_path):
        # Extract text, images, diagrams, and equations
        # Create structured knowledge graph
        # Generate embeddings for all content types
```

#### **3. Intelligent Tutoring Features**
- **Adaptive Learning**: Personalized difficulty adjustment
- **Progress Tracking**: Student performance analytics
- **Concept Mapping**: Visual knowledge representation
- **Interactive Exercises**: Auto-generated practice questions

### **Phase 2: Scalability & Infrastructure (Months 3-6)**

#### **1. Cloud-Ready Architecture**
```python
# Microservices architecture:
services = {
    "ai_service": "Model inference and NLP processing",
    "content_service": "NCERT content management", 
    "user_service": "Authentication and profiles",
    "analytics_service": "Learning analytics and insights"
}
```

#### **2. Advanced Deployment Options**
- **Docker Containers**: Easy deployment and scaling
- **Kubernetes**: Orchestration for high availability
- **Load Balancing**: Multiple model instances
- **CDN Integration**: Fast content delivery

#### **3. Database Integration**
- **PostgreSQL**: User data and progress tracking
- **Redis**: Caching and session management
- **Elasticsearch**: Advanced content search
- **InfluxDB**: Performance metrics and monitoring

### **Phase 3: Advanced Features (Months 6-12)**

#### **1. Multi-Modal AI**
- **Vision AI**: Diagram and image understanding
- **Math AI**: Equation solving and step-by-step explanations
- **Drawing Recognition**: Hand-drawn problem solving
- **AR/VR Integration**: Immersive learning experiences

#### **2. Advanced Analytics**
```python
class LearningAnalytics:
    def analyze_student_progress(self, student_id):
        return {
            "knowledge_gaps": self.identify_weak_areas(),
            "learning_style": self.detect_learning_preferences(),
            "recommended_content": self.suggest_next_topics(),
            "performance_trends": self.track_improvement()
        }
```

#### **3. Collaborative Features**
- **Multi-user Sessions**: Group study capabilities
- **Teacher Dashboard**: Classroom management tools
- **Parent Portal**: Progress monitoring for parents
- **Peer Learning**: Student-to-student interaction

### **Phase 4: Advanced AI & Research (Year 2)**

#### **1. Cutting-Edge AI Research**
- **Retrieval-Augmented Generation (RAG)**: Enhanced accuracy
- **Chain-of-Thought Reasoning**: Step-by-step problem solving
- **Multi-Agent Systems**: Specialized AI tutors for different subjects
- **Reinforcement Learning**: AI that learns from student interactions

#### **2. Educational Innovation**
- **Adaptive Curriculum**: AI-generated learning paths
- **Intelligent Assessment**: Automated testing and grading
- **Personalized Content**: Custom-generated educational materials
- **Predictive Analytics**: Early intervention for struggling students

## Detailed Architecture Diagrams

### **Current System Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERFACE LAYER                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Web Browser    â”‚    â”‚  Mobile App     â”‚    â”‚  Desktop    â”‚ â”‚
â”‚  â”‚  â€¢ Chrome/Edge  â”‚    â”‚  (Future)       â”‚    â”‚  (Future)   â”‚ â”‚
â”‚  â”‚  â€¢ Safari/FF    â”‚    â”‚  â€¢ iOS/Android  â”‚    â”‚  â€¢ Electron â”‚ â”‚
â”‚  â”‚  â€¢ Responsive   â”‚    â”‚  â€¢ Native UI    â”‚    â”‚  â€¢ Cross-OS â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS/WSS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY LAYER                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Load Balancer  â”‚    â”‚  Rate Limiting  â”‚    â”‚  Auth/JWT   â”‚ â”‚
â”‚  â”‚  â€¢ Nginx/HAProxyâ”‚    â”‚  â€¢ Request Caps â”‚    â”‚  â€¢ Security â”‚ â”‚
â”‚  â”‚  â€¢ SSL Term.    â”‚    â”‚  â€¢ DDoS Protect â”‚    â”‚  â€¢ Sessions â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  APPLICATION LAYER (FastAPI)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chat Service   â”‚    â”‚  Voice Service  â”‚    â”‚  Content    â”‚ â”‚
â”‚  â”‚  â€¢ Q&A Logic    â”‚    â”‚  â€¢ STT/TTS      â”‚    â”‚  â€¢ Chapters â”‚ â”‚
â”‚  â”‚  â€¢ Context Mgmt â”‚    â”‚  â€¢ Audio Proc.  â”‚    â”‚  â€¢ Summariesâ”‚ â”‚
â”‚  â”‚  â€¢ Anti-Halluc. â”‚    â”‚  â€¢ Real-time    â”‚    â”‚  â€¢ Search   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI/ML LAYER                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Model Pool     â”‚    â”‚  Embedding      â”‚    â”‚  Fallback   â”‚ â”‚
â”‚  â”‚  â€¢ 3x Vicuna    â”‚    â”‚  â€¢ Sentence     â”‚    â”‚  â€¢ Text     â”‚ â”‚
â”‚  â”‚  â€¢ Load Balance â”‚    â”‚  â€¢ Transformers â”‚    â”‚  â€¢ Matching â”‚ â”‚
â”‚  â”‚  â€¢ Auto-scale   â”‚    â”‚  â€¢ Vector DB    â”‚    â”‚  â€¢ Gen. KG  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAYER                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Content Store  â”‚    â”‚  Vector Store   â”‚    â”‚  User Data  â”‚ â”‚
â”‚  â”‚  â€¢ NCERT Files  â”‚    â”‚  â€¢ ChromaDB     â”‚    â”‚  â€¢ Profiles â”‚ â”‚
â”‚  â”‚  â€¢ Processed    â”‚    â”‚  â€¢ Embeddings   â”‚    â”‚  â€¢ Progress â”‚ â”‚
â”‚  â”‚  â€¢ Structured   â”‚    â”‚  â€¢ Semantic     â”‚    â”‚  â€¢ History  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Planned Microservices Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND SERVICES                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Web App        â”‚    â”‚  Mobile App     â”‚    â”‚  Teacher    â”‚ â”‚
â”‚  â”‚  â€¢ Student UI   â”‚    â”‚  â€¢ Native iOS   â”‚    â”‚  â€¢ Dashboardâ”‚ â”‚
â”‚  â”‚  â€¢ React/Vue    â”‚    â”‚  â€¢ Native And.  â”‚    â”‚  â€¢ Analyticsâ”‚ â”‚
â”‚  â”‚  â€¢ PWA Ready    â”‚    â”‚  â€¢ Offline Mode â”‚    â”‚  â€¢ Admin UI â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ GraphQL/REST
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MICROSERVICES LAYER                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AI Service     â”‚    â”‚  Content Svc    â”‚    â”‚  User Svc   â”‚ â”‚
â”‚  â”‚  â€¢ Model Mgmt   â”‚    â”‚  â€¢ NCERT Data   â”‚    â”‚  â€¢ Auth     â”‚ â”‚
â”‚  â”‚  â€¢ Inference    â”‚    â”‚  â€¢ Processing   â”‚    â”‚  â€¢ Profiles â”‚ â”‚
â”‚  â”‚  â€¢ Scaling      â”‚    â”‚  â€¢ Search       â”‚    â”‚  â€¢ Progress â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Voice Service  â”‚    â”‚  Analytics Svc  â”‚    â”‚  Notificationâ”‚ â”‚
â”‚  â”‚  â€¢ STT/TTS      â”‚    â”‚  â€¢ Learning     â”‚    â”‚  â€¢ Email    â”‚ â”‚
â”‚  â”‚  â€¢ Audio Proc.  â”‚    â”‚  â€¢ Performance  â”‚    â”‚  â€¢ Push     â”‚ â”‚
â”‚  â”‚  â€¢ Real-time    â”‚    â”‚  â€¢ Insights     â”‚    â”‚  â€¢ SMS      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ Message Queue
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE LAYER                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Kubernetes     â”‚    â”‚  Message Queue  â”‚    â”‚  Monitoring â”‚ â”‚
â”‚  â”‚  â€¢ Orchestrationâ”‚    â”‚  â€¢ Redis/Kafka â”‚    â”‚  â€¢ Prometheusâ”‚ â”‚
â”‚  â”‚  â€¢ Auto-scaling â”‚    â”‚  â€¢ Event Stream â”‚    â”‚  â€¢ Grafana  â”‚ â”‚
â”‚  â”‚  â€¢ Load Balance â”‚    â”‚  â€¢ Pub/Sub      â”‚    â”‚  â€¢ Logging  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Optimization Strategies

### **Current Optimizations**
1. **Model Quantization**: 75% memory reduction with minimal accuracy loss
2. **Connection Pooling**: Reuse database connections
3. **Response Caching**: Cache frequent questions
4. **Lazy Loading**: Load models only when needed
5. **Async Processing**: Non-blocking I/O operations

### **Planned Optimizations**
1. **Model Distillation**: Smaller, faster models with similar accuracy
2. **Edge Deployment**: Local processing on user devices
3. **CDN Integration**: Global content distribution
4. **GPU Acceleration**: CUDA optimization for inference
5. **Batch Processing**: Group similar requests for efficiency

## Security & Privacy Considerations

### **Current Security Measures**
- **Input Validation**: Sanitize all user inputs
- **Rate Limiting**: Prevent abuse and DoS attacks
- **HTTPS Only**: Encrypted communication
- **Local Processing**: No data sent to external APIs
- **Content Filtering**: Age-appropriate responses only

### **Planned Security Enhancements**
- **Authentication**: User accounts and session management
- **Authorization**: Role-based access control
- **Data Encryption**: At-rest and in-transit encryption
- **Audit Logging**: Comprehensive activity tracking
- **Privacy Controls**: GDPR compliance and data protection

## Success Metrics & KPIs

### **Technical Metrics**
- **Response Time**: < 5 seconds for 95% of queries
- **Accuracy**: > 90% correct answers for curriculum questions
- **Uptime**: 99.9% availability target
- **Concurrent Users**: Support for 100+ simultaneous users
- **Memory Usage**: < 8GB RAM for full AI mode

### **Educational Metrics**
- **Student Engagement**: Session duration and return rate
- **Learning Outcomes**: Improvement in test scores
- **Content Coverage**: Questions answered across all chapters
- **User Satisfaction**: Feedback ratings and NPS scores

# NCERT AI Tutor - Technical Architecture Guide

## System Architecture Overview

This document provides a comprehensive technical overview of the NCERT AI Tutor system architecture, implementation details, and scalability considerations.

## Table of Contents

1. [High-Level Architecture](#high-level-architecture)
2. [Component Details](#component-details)
3. [Data Flow Diagrams](#data-flow-diagrams)
4. [Scalability Architecture](#scalability-architecture)
5. [Deployment Strategies](#deployment-strategies)
6. [Performance Optimization](#performance-optimization)
7. [Security Architecture](#security-architecture)
8. [Future Architecture Plans](#future-architecture-plans)

---

## High-Level Architecture

### Current System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Web Browser   â”‚  â”‚   Mobile Web    â”‚  â”‚   Desktop PWA   â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ HTML5/CSS3    â”‚  â”‚ â€¢ Responsive    â”‚  â”‚ â€¢ Offline Mode  â”‚            â”‚
â”‚  â”‚ â€¢ JavaScript ES6â”‚  â”‚ â€¢ Touch UI      â”‚  â”‚ â€¢ Native Feel   â”‚            â”‚
â”‚  â”‚ â€¢ WebRTC Audio  â”‚  â”‚ â€¢ Voice Input   â”‚  â”‚ â€¢ File Access   â”‚            â”‚
â”‚  â”‚ â€¢ Local Storage â”‚  â”‚ â€¢ Gestures      â”‚  â”‚ â€¢ Notifications â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ HTTP/HTTPS + WebSocket
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WEB SERVER LAYER                                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Uvicorn ASGI  â”‚  â”‚   Static Files  â”‚  â”‚   WebSocket     â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ Async Server  â”‚  â”‚ â€¢ CSS/JS/Images â”‚  â”‚ â€¢ Real-time     â”‚            â”‚
â”‚  â”‚ â€¢ HTTP/2 Supportâ”‚  â”‚ â€¢ Compression   â”‚  â”‚ â€¢ Live Updates  â”‚            â”‚
â”‚  â”‚ â€¢ SSL/TLS       â”‚  â”‚ â€¢ Caching       â”‚  â”‚ â€¢ Notifications â”‚            â”‚
â”‚  â”‚ â€¢ Load Balancingâ”‚  â”‚ â€¢ CDN Ready     â”‚  â”‚ â€¢ Typing Status â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APPLICATION LAYER                                  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   FastAPI Core  â”‚  â”‚   Middleware    â”‚  â”‚   API Routes    â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ Request Routerâ”‚  â”‚ â€¢ CORS Handler  â”‚  â”‚ â€¢ /ask          â”‚            â”‚
â”‚  â”‚ â€¢ Validation    â”‚  â”‚ â€¢ Auth Guard    â”‚  â”‚ â€¢ /summarize    â”‚            â”‚
â”‚  â”‚ â€¢ Serialization â”‚  â”‚ â€¢ Rate Limiter  â”‚  â”‚ â€¢ /voice-chat   â”‚            â”‚
â”‚  â”‚ â€¢ Error Handler â”‚  â”‚ â€¢ Logging       â”‚  â”‚ â€¢ /health       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BUSINESS LOGIC LAYER                              â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Chat Service   â”‚  â”‚  Voice Service  â”‚  â”‚ Content Service â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ Q&A Logic     â”‚  â”‚ â€¢ STT/TTS       â”‚  â”‚ â€¢ Chapter Mgmt  â”‚            â”‚
â”‚  â”‚ â€¢ Context Mgmt  â”‚  â”‚ â€¢ Audio Process â”‚  â”‚ â€¢ Search Logic  â”‚            â”‚
â”‚  â”‚ â€¢ Anti-Halluc.  â”‚  â”‚ â€¢ Format Conv.  â”‚  â”‚ â€¢ Summarization â”‚            â”‚
â”‚  â”‚ â€¢ Fallback Sys. â”‚  â”‚ â€¢ Quality Check â”‚  â”‚ â€¢ Classificationâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AI/ML LAYER                                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Model Pool    â”‚  â”‚  Vector Store   â”‚  â”‚  Fallback AI    â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ 3x Vicuna-7B  â”‚  â”‚ â€¢ ChromaDB      â”‚  â”‚ â€¢ Text Matching â”‚            â”‚
â”‚  â”‚ â€¢ Load Balancer â”‚  â”‚ â€¢ Embeddings    â”‚  â”‚ â€¢ General KG    â”‚            â”‚
â”‚  â”‚ â€¢ Health Check  â”‚  â”‚ â€¢ Semantic      â”‚  â”‚ â€¢ Safe Answers  â”‚            â”‚
â”‚  â”‚ â€¢ Auto-scaling  â”‚  â”‚ â€¢ Fast Retrievalâ”‚  â”‚ â€¢ Pattern Match â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  File System    â”‚  â”‚   Vector DB     â”‚  â”‚   Config Store  â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ NCERT Content â”‚  â”‚ â€¢ Embeddings    â”‚  â”‚ â€¢ Model Paths   â”‚            â”‚
â”‚  â”‚ â€¢ Audio Files   â”‚  â”‚ â€¢ Indices       â”‚  â”‚ â€¢ API Keys      â”‚            â”‚
â”‚  â”‚ â€¢ Model Files   â”‚  â”‚ â€¢ Metadata      â”‚  â”‚ â€¢ Settings      â”‚            â”‚
â”‚  â”‚ â€¢ Cache Data    â”‚  â”‚ â€¢ Collections   â”‚  â”‚ â€¢ Environment   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Details

### 1. **Frontend Components**

#### **ChatApp Class Architecture**
```javascript
class ChatApp {
    // Core Properties
    constructor() {
        this.chatMessages = document.getElementById('chat-messages');
        this.userInput = document.getElementById('user-input');
        this.voiceEnabled = true;
        this.speechEnabled = true;
        this.selectedChapter = null;
        this.chatHistory = [];
    }
    
    // Message Handling
    async sendMessage() {
        const question = this.userInput.value.trim();
        if (!question) return;
        
        this.addMessage(question, 'user');
        this.showTypingIndicator();
        
        try {
            const response = await this.callAPI('/ask', {
                question: question,
                chapter: this.selectedChapter
            });
            
            this.hideTypingIndicator();
            this.addMessage(response.answer, 'assistant');
            
            if (response.audio_url && this.speechEnabled) {
                this.playAudio(response.audio_url);
            }
        } catch (error) {
            this.handleError(error);
        }
    }
    
    // Voice Processing
    async toggleRecording() {
        if (this.isRecording) {
            this.stopRecording();
        } else {
            await this.startRecording();
        }
    }
    
    // Chapter Management
    selectChapter(chapterName) {
        this.selectedChapter = chapterName;
        this.updateChapterDisplay(chapterName);
        this.loadChapterContext(chapterName);
    }
}
```

#### **UI Component Structure**
```html
<!-- Main Layout -->
<div class="app-container">
    <!-- Navigation Bar -->
    <nav class="top-navigation">
        <div class="brand">Pragati Pathshala</div>
        <div class="controls">
            <select id="language-select">English/Hindi</select>
            <select id="class-select">Class 6</select>
            <select id="chapter-select">Chapters</select>
        </div>
        <div class="status">AI Assistant Online</div>
    </nav>
    
    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="vrita-logo">Vrita AI</div>
            <nav class="navigation">
                <a href="#" class="nav-item active">AI Chatbot</a>
                <a href="#" class="nav-item">Home</a>
            </nav>
            <div class="chapter-selection">
                <h3>English Chapters</h3>
                <div class="chapter-list">
                    <!-- Dynamic chapter buttons -->
                </div>
            </div>
        </aside>
        
        <!-- Chat Interface -->
        <main class="chat-container">
            <div class="chat-header">
                <div class="teacher-avatar">
                    <!-- Animated avatar -->
                </div>
                <div class="chat-info">
                    <h2>AI Tutor</h2>
                    <p>Ask me about NCERT chapters</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <!-- Dynamic messages -->
            </div>
            
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ask a question...">
                <button id="mic-btn">ğŸ¤</button>
                <button id="send-btn">Send</button>
                <button id="speaker-btn">ğŸ”Š</button>
            </div>
        </main>
    </div>
</div>
```

### 2. **Backend Architecture**

#### **FastAPI Application Structure**
```python
# Main Application
app = FastAPI(
    title="NCERT AI Tutor",
    description="Local Vicuna-7B powered educational assistant",
    version="2.0.0"
)

# Middleware Stack
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Static File Serving
app.mount("/static", StaticFiles(directory="static"), name="static")

# API Routes
@app.post("/ask", response_model=AnswerResponse)
async def ask_question(request: QuestionRequest):
    """Main Q&A endpoint with intelligent routing"""
    
@app.get("/summarize/{chapter}", response_model=SummaryResponse)
async def summarize_chapter(chapter: str):
    """Chapter summarization endpoint"""
    
@app.post("/speech-to-text")
async def speech_to_text(audio: UploadFile = File(...)):
    """Voice input processing"""
    
@app.post("/voice-chat", response_model=VoiceChatResponse)
async def voice_chat(audio: UploadFile = File(...)):
    """Complete voice interaction pipeline"""
    
@app.get("/health")
async def health_check():
    """System health and capability check"""
```

#### **Model Pool Implementation**
```python
class ModelPool:
    def __init__(self, pool_size=3):
        self.pool = Queue(maxsize=pool_size)
        self.lock = threading.Lock()
        self.pool_size = pool_size
        self.active_models = 0
        
        # Initialize model pool
        for i in range(pool_size):
            model = self._create_model_instance()
            if model:
                self.pool.put(model)
                self.active_models += 1
    
    def _create_model_instance(self):
        """Create a single model instance with optimized settings"""
        try:
            return Llama(
                model_path=str(MODEL_PATH),
                n_ctx=CONTEXT_SIZE,
                n_gpu_layers=0,  # CPU-only for stability
                verbose=False,
                n_threads=2,     # Reduced per instance
                n_batch=256,     # Optimized batch size
                use_mmap=True,   # Memory mapping
                use_mlock=False, # No memory locking
                f16_kv=False     # Standard precision
            )
        except Exception as e:
            logger.error(f"Failed to create model: {e}")
            return None
    
    def get_model(self, timeout=30):
        """Get a model from the pool with timeout"""
        try:
            return self.pool.get(timeout=timeout)
        except:
            raise HTTPException(503, "All models busy, try again later")
    
    def return_model(self, model):
        """Return model to pool"""
        if model:
            self.pool.put(model)
    
    def get_stats(self):
        """Get pool statistics"""
        return {
            "total_models": self.pool_size,
            "available_models": self.pool.qsize(),
            "active_models": self.active_models,
            "busy_models": self.active_models - self.pool.qsize()
        }
```

### 3. **AI/ML Pipeline**

#### **Question Processing Flow**
```python
async def process_question(question: str, chapter: str = None):
    """Complete question processing pipeline"""
    
    # 1. Input Validation & Sanitization
    question = sanitize_input(question)
    if not validate_question(question):
        raise HTTPException(400, "Invalid question format")
    
    # 2. Chapter Detection & Content Loading
    if not chapter:
        chapter = detect_relevant_chapter(question)
    
    content = load_chapter_content(chapter)
    
    # 3. AI Processing with Fallback
    try:
        # Try AI model first
        model = model_pool.get_model()
        try:
            answer = await generate_ai_answer(model, question, content)
            
            # Validate AI response
            if validate_ai_response(answer, content, question):
                return {
                    "answer": answer,
                    "mode": "ai",
                    "sources": [chapter],
                    "confidence": calculate_confidence(answer, content)
                }
            else:
                logger.warning("AI response failed validation, using fallback")
                raise AIValidationError("Response validation failed")
                
        finally:
            model_pool.return_model(model)
            
    except Exception as e:
        logger.warning(f"AI processing failed: {e}, using fallback")
        
        # Fallback to intelligent text matching
        answer = enhanced_fallback_processing(question, content)
        return {
            "answer": answer,
            "mode": "fallback",
            "sources": [chapter],
            "confidence": 0.7
        }

def generate_ai_answer(model, question: str, content: str) -> str:
    """Generate AI answer with anti-hallucination measures"""
    
    prompt = f"""You are an expert NCERT tutor. Follow these STRICT rules:

ANTI-HALLUCINATION RULES:
1. ONLY use information from the provided chapter text
2. If the chapter doesn't contain the answer, say "The chapter does not contain information about this"
3. NEVER invent characters, events, or facts not in the chapter
4. NEVER guess or create new information
5. If unsure, say "I need more information to answer that"

Chapter Content:
{content[:3000]}

Student Question: {question}

Educational Answer (Use ONLY chapter content):"""

    response = model(
        prompt,
        max_tokens=350,
        temperature=0.2,  # Low temperature for factual responses
        top_p=0.7,
        stop=["Student Question:", "Chapter Content:"],
        echo=False,
        repeat_penalty=1.15
    )
    
    return response['choices'][0]['text'].strip()

def validate_ai_response(answer: str, content: str, question: str) -> bool:
    """Validate AI response against source content"""
    
    # Check for hallucination indicators
    hallucination_patterns = [
        "according to my knowledge",
        "based on my understanding",
        "i believe",
        "probably",
        "it seems like"
    ]
    
    answer_lower = answer.lower()
    for pattern in hallucination_patterns:
        if pattern in answer_lower:
            return False
    
    # Check for invented character names
    import re
    answer_names = re.findall(r'\b[A-Z][a-z]{3,}\b', answer)
    content_lower = content.lower()
    
    invented_names = 0
    for name in answer_names:
        if name.lower() not in content_lower:
            # Allow common educational terms
            allowed_terms = ['chapter', 'story', 'ncert', 'class', 'student']
            if name.lower() not in allowed_terms:
                invented_names += 1
    
    # Fail if too many invented names (likely hallucination)
    if invented_names > 2:
        return False
    
    return True
```

---

## Data Flow Diagrams

### 1. **User Question Processing Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚    â”‚  Frontend   â”‚    â”‚   Backend   â”‚    â”‚   AI Model  â”‚
â”‚   Input     â”‚    â”‚   (JS)      â”‚    â”‚  (FastAPI)  â”‚    â”‚   (Vicuna)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 1. Type Question  â”‚                   â”‚                   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚
       â”‚                   â”‚ 2. Send POST      â”‚                   â”‚
       â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
       â”‚                   â”‚    /ask           â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 3. Get Model      â”‚
       â”‚                   â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                   â”‚                   â”‚   from Pool       â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 4. Generate       â”‚
       â”‚                   â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                   â”‚                   â”‚   Answer          â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 5. Return Model   â”‚
       â”‚                   â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                   â”‚                   â”‚   to Pool         â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 6. JSON Response  â”‚                   â”‚
       â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 7. Display Answer â”‚                   â”‚                   â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
```

### 2. **Voice Interaction Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Microphone â”‚    â”‚  Browser    â”‚    â”‚   Backend   â”‚    â”‚   TTS       â”‚
â”‚   Input     â”‚    â”‚   WebRTC    â”‚    â”‚  (FastAPI)  â”‚    â”‚  Engine     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 1. Voice Input    â”‚                   â”‚                   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚
       â”‚                   â”‚ 2. Record Audio   â”‚                   â”‚
       â”‚                   â”‚   (WebRTC)        â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 3. Upload Audio   â”‚                   â”‚
       â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
       â”‚                   â”‚   /speech-to-text â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 4. STT Process    â”‚
       â”‚                   â”‚                   â”‚   (SpeechRec)     â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 5. Text Response  â”‚                   â”‚
       â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 6. Process Q&A    â”‚                   â”‚
       â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
       â”‚                   â”‚   (Same as above) â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 7. Generate Audio â”‚                   â”‚
       â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 8. Play Audio     â”‚                   â”‚                   â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
```

### 3. **Concurrent User Handling**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User A    â”‚    â”‚   User B    â”‚    â”‚   User C    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚ Question A        â”‚ Question B        â”‚ Question C
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Server                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Thread 1   â”‚    â”‚  Thread 2   â”‚    â”‚  Thread 3   â”‚        â”‚
â”‚  â”‚  (User A)   â”‚    â”‚  (User B)   â”‚    â”‚  (User C)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚         â–¼                   â–¼                   â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Model Pool                               â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚Model 1  â”‚    â”‚Model 2  â”‚    â”‚Model 3  â”‚            â”‚   â”‚
â”‚  â”‚  â”‚(User A) â”‚    â”‚(User B) â”‚    â”‚(User C) â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response A  â”‚    â”‚ Response B  â”‚    â”‚ Response C  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Scalability Architecture

### **Current Scalable Implementation**

#### **Model Pool Configuration**
```python
# Scalable model pool settings
MODEL_POOL_CONFIG = {
    "pool_size": 3,           # Number of model instances
    "max_workers": 8,         # Thread pool size
    "request_timeout": 30,    # Request timeout in seconds
    "health_check_interval": 60,  # Health check frequency
    "auto_restart": True,     # Auto-restart failed models
    "memory_limit": "8GB",    # Per-model memory limit
    "cpu_affinity": True      # CPU core binding
}

class ScalableModelPool:
    def __init__(self, config):
        self.config = config
        self.models = Queue(maxsize=config["pool_size"])
        self.health_monitor = HealthMonitor()
        self.load_balancer = LoadBalancer()
        
        # Initialize models with staggered startup
        for i in range(config["pool_size"]):
            time.sleep(2)  # Prevent memory spikes
            model = self._create_optimized_model(i)
            if model:
                self.models.put(model)
    
    def _create_optimized_model(self, instance_id):
        """Create model with instance-specific optimizations"""
        return Llama(
            model_path=str(MODEL_PATH),
            n_ctx=2048,              # Reduced context for memory
            n_threads=2,             # 2 threads per model
            n_batch=256,             # Optimized batch size
            use_mmap=True,           # Memory mapping
            use_mlock=False,         # No memory locking
            verbose=False,
            seed=instance_id         # Different seed per instance
        )
    
    async def process_request(self, request_data):
        """Process request with load balancing and failover"""
        start_time = time.time()
        
        try:
            # Get model with timeout
            model = await asyncio.wait_for(
                self._get_model_async(), 
                timeout=self.config["request_timeout"]
            )
            
            try:
                # Process with the model
                result = await self._process_with_model(model, request_data)
                
                # Update performance metrics
                processing_time = time.time() - start_time
                self.health_monitor.record_success(processing_time)
                
                return result
                
            finally:
                # Always return model to pool
                self._return_model(model)
                
        except asyncio.TimeoutError:
            self.health_monitor.record_timeout()
            raise HTTPException(503, "Request timeout - server busy")
        except Exception as e:
            self.health_monitor.record_error(str(e))
            raise HTTPException(500, f"Processing error: {e}")
```

#### **Load Balancing Strategy**
```python
class LoadBalancer:
    def __init__(self):
        self.request_counts = defaultdict(int)
        self.response_times = defaultdict(list)
        self.error_counts = defaultdict(int)
    
    def select_optimal_model(self, available_models):
        """Select best model based on performance metrics"""
        if not available_models:
            return None
        
        # Score models based on:
        # 1. Current load (request count)
        # 2. Average response time
        # 3. Error rate
        
        best_model = None
        best_score = float('inf')
        
        for model_id in available_models:
            load_score = self.request_counts[model_id]
            time_score = np.mean(self.response_times[model_id][-10:]) or 0
            error_score = self.error_counts[model_id] * 10
            
            total_score = load_score + time_score + error_score
            
            if total_score < best_score:
                best_score = total_score
                best_model = model_id
        
        return best_model
    
    def update_metrics(self, model_id, response_time, success=True):
        """Update performance metrics for load balancing"""
        self.request_counts[model_id] += 1
        self.response_times[model_id].append(response_time)
        
        if not success:
            self.error_counts[model_id] += 1
        
        # Keep only recent metrics (sliding window)
        if len(self.response_times[model_id]) > 100:
            self.response_times[model_id] = self.response_times[model_id][-50:]
```

### **Future Microservices Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            API GATEWAY                                      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Load Balancer  â”‚  â”‚  Rate Limiter   â”‚  â”‚  Auth Service   â”‚            â”‚
â”‚  â”‚  â€¢ Nginx/HAProxyâ”‚  â”‚  â€¢ Redis-based  â”‚  â”‚  â€¢ JWT Tokens   â”‚            â”‚
â”‚  â”‚  â€¢ Health Check â”‚  â”‚  â€¢ Per-user     â”‚  â”‚  â€¢ Role-based   â”‚            â”‚
â”‚  â”‚  â€¢ SSL Term.    â”‚  â”‚  â€¢ Adaptive     â”‚  â”‚  â€¢ Session Mgmt â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MICROSERVICES LAYER                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   AI Service    â”‚  â”‚ Content Service â”‚  â”‚  User Service   â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ Model Pool    â”‚  â”‚ â€¢ NCERT Data    â”‚  â”‚ â€¢ Profiles      â”‚            â”‚
â”‚  â”‚ â€¢ Inference     â”‚  â”‚ â€¢ Search Index  â”‚  â”‚ â€¢ Progress      â”‚            â”‚
â”‚  â”‚ â€¢ Auto-scaling  â”‚  â”‚ â€¢ Summarization â”‚  â”‚ â€¢ Preferences   â”‚            â”‚
â”‚  â”‚ â€¢ Health Check  â”‚  â”‚ â€¢ Classificationâ”‚  â”‚ â€¢ Analytics     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Voice Service  â”‚  â”‚Analytics Serviceâ”‚  â”‚Notification Svc â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ STT/TTS       â”‚  â”‚ â€¢ Learning Data â”‚  â”‚ â€¢ Email/SMS     â”‚            â”‚
â”‚  â”‚ â€¢ Audio Process â”‚  â”‚ â€¢ Performance   â”‚  â”‚ â€¢ Push Notif.   â”‚            â”‚
â”‚  â”‚ â€¢ Real-time     â”‚  â”‚ â€¢ Insights      â”‚  â”‚ â€¢ Alerts        â”‚            â”‚
â”‚  â”‚ â€¢ Quality Check â”‚  â”‚ â€¢ Reporting     â”‚  â”‚ â€¢ Reminders     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MESSAGE QUEUE                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚     Redis       â”‚  â”‚     Kafka       â”‚  â”‚   RabbitMQ      â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ Caching       â”‚  â”‚ â€¢ Event Stream  â”‚  â”‚ â€¢ Task Queue    â”‚            â”‚
â”‚  â”‚ â€¢ Session Store â”‚  â”‚ â€¢ Log Aggreg.   â”‚  â”‚ â€¢ Job Process   â”‚            â”‚
â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Real-time     â”‚  â”‚ â€¢ Async Tasks   â”‚            â”‚
â”‚  â”‚ â€¢ Pub/Sub       â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Scheduling    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATA LAYER                                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚   Elasticsearch â”‚  â”‚    MinIO/S3     â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ User Data     â”‚  â”‚ â€¢ Content Searchâ”‚  â”‚ â€¢ File Storage  â”‚            â”‚
â”‚  â”‚ â€¢ Progress      â”‚  â”‚ â€¢ Log Analysis  â”‚  â”‚ â€¢ Model Files   â”‚            â”‚
â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Full-text     â”‚  â”‚ â€¢ Audio Files   â”‚            â”‚
â”‚  â”‚ â€¢ Transactions  â”‚  â”‚ â€¢ Aggregations  â”‚  â”‚ â€¢ Backups       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Architecture

### **Current Security Measures**

#### **Input Validation & Sanitization**
```python
class SecurityValidator:
    def __init__(self):
        self.max_question_length = 1000
        self.allowed_characters = re.compile(r'^[a-zA-Z0-9\s\.\?\!\,\-\'\"\(\)]+$')
        self.rate_limiter = RateLimiter()
    
    def validate_question(self, question: str, user_ip: str) -> bool:
        """Comprehensive input validation"""
        
        # Rate limiting check
        if not self.rate_limiter.check_limit(user_ip):
            raise HTTPException(429, "Too many requests")
        
        # Length validation
        if len(question) > self.max_question_length:
            raise HTTPException(400, "Question too long")
        
        # Character validation
        if not self.allowed_characters.match(question):
            raise HTTPException(400, "Invalid characters in question")
        
        # Content filtering
        if self.contains_inappropriate_content(question):
            raise HTTPException(400, "Inappropriate content detected")
        
        return True
    
    def contains_inappropriate_content(self, text: str) -> bool:
        """Check for inappropriate content"""
        inappropriate_patterns = [
            r'\b(password|login|hack|exploit)\b',
            r'\b(personal|private|confidential)\b',
            r'\b(attack|malware|virus)\b'
        ]
        
        text_lower = text.lower()
        for pattern in inappropriate_patterns:
            if re.search(pattern, text_lower):
                return True
        
        return False

class RateLimiter:
    def __init__(self):
        self.requests = defaultdict(list)
        self.limits = {
            "per_minute": 30,
            "per_hour": 200,
            "per_day": 1000
        }
    
    def check_limit(self, user_ip: str) -> bool:
        """Check if user is within rate limits"""
        now = time.time()
        user_requests = self.requests[user_ip]
        
        # Clean old requests
        user_requests[:] = [req_time for req_time in user_requests 
                           if now - req_time < 86400]  # 24 hours
        
        # Check limits
        minute_requests = sum(1 for req_time in user_requests 
                             if now - req_time < 60)
        hour_requests = sum(1 for req_time in user_requests 
                           if now - req_time < 3600)
        day_requests = len(user_requests)
        
        if (minute_requests >= self.limits["per_minute"] or
            hour_requests >= self.limits["per_hour"] or
            day_requests >= self.limits["per_day"]):
            return False
        
        # Add current request
        user_requests.append(now)
        return True
```

#### **Response Filtering**
```python
class ResponseFilter:
    def __init__(self):
        self.inappropriate_patterns = [
            r'\b(password|login|hack)\b',
            r'\b(personal information|private data)\b',
            r'\b(contact me|meet me|phone number)\b'
        ]
    
    def filter_response(self, response: str) -> str:
        """Filter AI response for safety"""
        
        # Check for inappropriate content
        for pattern in self.inappropriate_patterns:
            if re.search(pattern, response.lower()):
                return "I can only help with educational questions about NCERT chapters."
        
        # Ensure educational focus
        if not self.is_educational_content(response):
            return "Let me help you with questions about the NCERT chapters we're studying."
        
        return response
    
    def is_educational_content(self, text: str) -> bool:
        """Check if content is educational"""
        educational_keywords = [
            'chapter', 'story', 'character', 'lesson', 'moral',
            'ncert', 'class', 'student', 'learn', 'understand'
        ]
        
        text_lower = text.lower()
        return any(keyword in text_lower for keyword in educational_keywords)
```

### **Planned Security Enhancements**

#### **Authentication & Authorization**
```python
# JWT-based authentication system
class AuthenticationService:
    def __init__(self):
        self.secret_key = os.getenv("JWT_SECRET_KEY")
        self.algorithm = "HS256"
        self.access_token_expire = 30  # minutes
    
    def create_access_token(self, user_data: dict):
        """Create JWT access token"""
        expire = datetime.utcnow() + timedelta(minutes=self.access_token_expire)
        to_encode = user_data.copy()
        to_encode.update({"exp": expire})
        
        return jwt.encode(to_encode, self.secret_key, algorithm=self.algorithm)
    
    def verify_token(self, token: str):
        """Verify JWT token"""
        try:
            payload = jwt.decode(token, self.secret_key, algorithms=[self.algorithm])
            return payload
        except jwt.ExpiredSignatureError:
            raise HTTPException(401, "Token expired")
        except jwt.JWTError:
            raise HTTPException(401, "Invalid token")

# Role-based access control
class AuthorizationService:
    def __init__(self):
        self.roles = {
            "student": ["ask_questions", "view_content"],
            "teacher": ["ask_questions", "view_content", "view_analytics"],
            "admin": ["ask_questions", "view_content", "view_analytics", "manage_users"]
        }
    
    def check_permission(self, user_role: str, required_permission: str) -> bool:
        """Check if user has required permission"""
        return required_permission in self.roles.get(user_role, [])
```

---

## Performance Optimization

### **Current Optimizations**

#### **Model Quantization Strategy**
```python
class ModelQuantizationManager:
    def __init__(self):
        self.quantization_configs = {
            "q4_k_m": {
                "memory_usage": "3.5GB",
                "inference_speed": "fastest",
                "accuracy": "good",
                "use_case": "real_time_chat"
            },
            "q6_k": {
                "memory_usage": "5.0GB", 
                "inference_speed": "balanced",
                "accuracy": "better",
                "use_case": "general_tutoring"
            },
            "q8": {
                "memory_usage": "7.0GB",
                "inference_speed": "slower",
                "accuracy": "highest", 
                "use_case": "complex_analysis"
            }
        }
    
    def select_optimal_quantization(self, available_memory: int, 
                                   performance_requirement: str) -> str:
        """Select best quantization based on system resources"""
        
        if available_memory < 4:
            return "q4_k_m"  # Force fastest for low memory
        elif available_memory < 6:
            return "q6_k" if performance_requirement != "speed" else "q4_k_m"
        else:
            if performance_requirement == "speed":
                return "q4_k_m"
            elif performance_requirement == "accuracy":
                return "q8"
            else:
                return "q6_k"  # Balanced default
```

#### **Caching Strategy**
```python
class ResponseCache:
    def __init__(self):
        self.cache = {}
        self.cache_ttl = 3600  # 1 hour
        self.max_cache_size = 1000
    
    def get_cache_key(self, question: str, chapter: str) -> str:
        """Generate cache key for question"""
        normalized_question = question.lower().strip()
        return hashlib.md5(f"{normalized_question}:{chapter}".encode()).hexdigest()
    
    def get_cached_response(self, question: str, chapter: str) -> Optional[str]:
        """Get cached response if available"""
        cache_key = self.get_cache_key(question, chapter)
        
        if cache_key in self.cache:
            cached_data = self.cache[cache_key]
            
            # Check if cache is still valid
            if time.time() - cached_data["timestamp"] < self.cache_ttl:
                return cached_data["response"]
            else:
                # Remove expired cache
                del self.cache[cache_key]
        
        return None
    
    def cache_response(self, question: str, chapter: str, response: str):
        """Cache response for future use"""
        cache_key = self.get_cache_key(question, chapter)
        
        # Implement LRU eviction if cache is full
        if len(self.cache) >= self.max_cache_size:
            oldest_key = min(self.cache.keys(), 
                           key=lambda k: self.cache[k]["timestamp"])
            del self.cache[oldest_key]
        
        self.cache[cache_key] = {
            "response": response,
            "timestamp": time.time()
        }
```

### **Planned Performance Enhancements**

#### **GPU Acceleration**
```python
class GPUAccelerationManager:
    def __init__(self):
        self.gpu_available = self.check_gpu_availability()
        self.gpu_memory = self.get_gpu_memory()
        
    def check_gpu_availability(self) -> bool:
        """Check if GPU acceleration is available"""
        try:
            import torch
            return torch.cuda.is_available()
        except ImportError:
            return False
    
    def get_gpu_memory(self) -> int:
        """Get available GPU memory in GB"""
        if not self.gpu_available:
            return 0
        
        try:
            import torch
            return torch.cuda.get_device_properties(0).total_memory // (1024**3)
        except:
            return 0
    
    def configure_gpu_model(self, model_path: str) -> dict:
        """Configure model for GPU acceleration"""
        if not self.gpu_available or self.gpu_memory < 6:
            return {"n_gpu_layers": 0}  # CPU only
        
        # Determine optimal GPU layers based on memory
        if self.gpu_memory >= 12:
            return {"n_gpu_layers": -1}  # All layers on GPU
        elif self.gpu_memory >= 8:
            return {"n_gpu_layers": 20}  # Partial GPU acceleration
        else:
            return {"n_gpu_layers": 10}  # Minimal GPU acceleration
```

---

## Future Architecture Plans

### **Phase 1: Enhanced AI Capabilities**

#### **Multi-Model Architecture**
```python
class MultiModelManager:
    def __init__(self):
        self.models = {
            "general": VicunaModel("vicuna-7b"),
            "math": MathSpecificModel("mathllama-7b"),
            "science": ScienceModel("science-llama-7b"),
            "hindi": HindiModel("hindi-vicuna-7b")
        }
        self.model_selector = ModelSelector()
    
    def select_optimal_model(self, question: str, subject: str) -> str:
        """Select best model for the question type"""
        
        # Analyze question to determine optimal model
        question_type = self.model_selector.analyze_question(question)
        
        if "math" in question_type or "calculation" in question_type:
            return "math"
        elif "science" in question_type or "experiment" in question_type:
            return "science"
        elif subject == "hindi" or self.detect_hindi_text(question):
            return "hindi"
        else:
            return "general"
    
    async def process_with_optimal_model(self, question: str, 
                                       context: str, subject: str) -> str:
        """Process question with the most suitable model"""
        
        model_type = self.select_optimal_model(question, subject)
        model = self.models[model_type]
        
        return await model.generate_response(question, context)
```

### **Phase 2: Advanced Analytics**

#### **Learning Analytics Engine**
```python
class LearningAnalyticsEngine:
    def __init__(self):
        self.student_profiles = {}
        self.learning_patterns = LearningPatternAnalyzer()
        self.recommendation_engine = RecommendationEngine()
    
    def analyze_student_interaction(self, student_id: str, 
                                  question: str, response_quality: float):
        """Analyze student learning patterns"""
        
        if student_id not in self.student_profiles:
            self.student_profiles[student_id] = StudentProfile(student_id)
        
        profile = self.student_profiles[student_id]
        
        # Update learning metrics
        profile.add_interaction(question, response_quality)
        
        # Analyze learning patterns
        patterns = self.learning_patterns.analyze(profile.get_history())
        
        # Generate recommendations
        recommendations = self.recommendation_engine.generate(patterns)
        
        return {
            "knowledge_gaps": patterns.get("gaps", []),
            "strengths": patterns.get("strengths", []),
            "recommendations": recommendations,
            "next_topics": self.suggest_next_topics(patterns)
        }
    
    def generate_progress_report(self, student_id: str) -> dict:
        """Generate comprehensive progress report"""
        
        profile = self.student_profiles.get(student_id)
        if not profile:
            return {"error": "No data available"}
        
        return {
            "overall_progress": profile.calculate_progress(),
            "chapter_completion": profile.get_chapter_progress(),
            "skill_development": profile.get_skill_metrics(),
            "time_spent": profile.get_time_metrics(),
            "improvement_trends": profile.get_trends()
        }
```

### **Phase 3: Cloud-Native Architecture**

#### **Kubernetes Deployment**
```yaml
# kubernetes/ai-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-service
  template:
    metadata:
      labels:
        app: ai-service
    spec:
      containers:
      - name: ai-service
        image: ncert-ai-tutor/ai-service:latest
        ports:
        - containerPort: 8000
        resources:
          requests:
            memory: "8Gi"
            cpu: "2"
          limits:
            memory: "16Gi"
            cpu: "4"
        env:
        - name: MODEL_PATH
          value: "/models/vicuna-7b-q6k.gguf"
        - name: POOL_SIZE
          value: "2"
        volumeMounts:
        - name: model-storage
          mountPath: /models
      volumes:
      - name: model-storage
        persistentVolumeClaim:
          claimName: model-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: ai-service
spec:
  selector:
    app: ai-service
  ports:
  - port: 80
    targetPort: 8000
  type: LoadBalancer
```

#### **Auto-Scaling Configuration**
```yaml
# kubernetes/ai-service-hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: ai-service-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: ai-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

## Monitoring & Observability

### **Health Monitoring System**
```python
class HealthMonitor:
    def __init__(self):
        self.metrics = {
            "requests_total": 0,
            "requests_successful": 0,
            "requests_failed": 0,
            "average_response_time": 0,
            "model_pool_utilization": 0,
            "memory_usage": 0,
            "cpu_usage": 0
        }
        self.alerts = AlertManager()
    
    def record_request(self, success: bool, response_time: float):
        """Record request metrics"""
        self.metrics["requests_total"] += 1
        
        if success:
            self.metrics["requests_successful"] += 1
        else:
            self.metrics["requests_failed"] += 1
        
        # Update average response time
        current_avg = self.metrics["average_response_time"]
        total_requests = self.metrics["requests_total"]
        
        self.metrics["average_response_time"] = (
            (current_avg * (total_requests - 1) + response_time) / total_requests
        )
        
        # Check for alerts
        self.check_alerts()
    
    def check_alerts(self):
        """Check for alert conditions"""
        error_rate = (self.metrics["requests_failed"] / 
                     max(self.metrics["requests_total"], 1))
        
        if error_rate > 0.1:  # 10% error rate
            self.alerts.send_alert("High error rate detected", 
                                 {"error_rate": error_rate})
        
        if self.metrics["average_response_time"] > 10:  # 10 seconds
            self.alerts.send_alert("High response time detected",
                                 {"avg_time": self.metrics["average_response_time"]})
    
    def get_health_status(self) -> dict:
        """Get current system health status"""
        return {
            "status": "healthy" if self.is_healthy() else "unhealthy",
            "metrics": self.metrics,
            "timestamp": time.time()
        }
    
    def is_healthy(self) -> bool:
        """Determine if system is healthy"""
        error_rate = (self.metrics["requests_failed"] / 
                     max(self.metrics["requests_total"], 1))
        
        return (error_rate < 0.05 and  # Less than 5% error rate
                self.metrics["average_response_time"] < 5 and  # Under 5 seconds
                self.metrics["model_pool_utilization"] < 0.9)  # Under 90% utilization
```

---

This technical architecture guide provides a comprehensive overview of the current system implementation and future scalability plans. The architecture is designed to be modular, scalable, and maintainable while ensuring high performance and reliability for educational use cases.
